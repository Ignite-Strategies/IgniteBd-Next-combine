generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_DATABASE_URL")
}

model GoogleOAuthToken {
  id           String   @id @default(cuid())
  ownerId      String
  provider     String   @default("google")
  refreshToken String
  scopes       String?
  email        String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  owners       owners   @relation(fields: [ownerId], references: [id], onDelete: Cascade)

  @@unique([ownerId, provider])
  @@index([ownerId])
}

model MicrosoftAccount {
  id      String @id @default(cuid())
  ownerId String
  owner   owners @relation(fields: [ownerId], references: [id], onDelete: Cascade)

  // Microsoft identity (can be different from owner.email!)
  microsoftEmail       String
  microsoftDisplayName String?
  microsoftTenantId    String?

  // OAuth tokens
  accessToken  String
  refreshToken String
  expiresAt    DateTime?

  // Metadata
  connectedAt     DateTime  @default(now())
  lastRefreshedAt DateTime?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@unique([ownerId]) // One Microsoft account per owner
  @@index([ownerId])
  @@index([microsoftEmail])
}

model assessments {
  id                   String       @id @default(cuid())
  ownerId              String
  companyHQId          String?
  name                 String
  company              String
  industry             String?
  workTooMuch          String?
  assignTasks          String?
  wantMoreClients      String?
  revenueGrowthPercent Float?
  totalVolume          Float?
  bdSpend              Float?
  score                Int?
  scoreInterpretation  String?
  relateWithUser       String?
  growthNeeds          String?
  rawGptResponse       String?
  createdAt            DateTime     @default(now())
  updatedAt            DateTime     @updatedAt
  company_hqs          company_hqs? @relation(fields: [companyHQId], references: [id])
  owners               owners       @relation(fields: [ownerId], references: [id], onDelete: Cascade)

  @@index([companyHQId])
  @@index([ownerId])
}

model bd_event_ops {
  id              String            @id @default(cuid())
  companyHQId     String
  ownerId         String
  eventPlanId     String?
  title           String
  description     String?
  whyGo           String?
  eventType       EventType
  startDate       DateTime?
  endDate         DateTime?
  city            String?
  state           String?
  country         String?
  location        String? // Combined location string (e.g., "San Francisco, CA")
  timeFrame       String? // General timeframe (e.g., "Q1 2025", "Spring 2025", "Early 2025")
  sponsor         String? // Main sponsor or organizer name
  costEstimate    String? // Cost estimate (e.g., "$500-$2,000", "Free", "$5,000+")
  costBand        String?
  source          EventSource       @default(MANUAL)
  status          EventOppStatus    @default(CONSIDERING)
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  eventTunerId    String?
  prioritySource  String?
  event_tuners    event_tuners?     @relation(fields: [eventTunerId], references: [id])
  event_plan_opps event_plan_opps[]

  @@index([companyHQId])
  @@index([eventPlanId])
  @@index([eventTunerId])
  @@index([ownerId])
  @@index([prioritySource])
  @@index([source])
  @@index([status])
}

model bd_eventop_intel {
  id               String         @id @default(cuid())
  companyHQId      String
  ownerId          String
  eventMetaId      String
  personaId        String?
  personaAlignment Int?
  travelBurden     Int?
  costFit          Int?
  ecosystemFit     Int?
  bdOpportunity    Int?
  notes            String?
  status           EventOppStatus @default(CONSIDERING)
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  event_metas      event_metas    @relation(fields: [eventMetaId], references: [id])

  @@index([companyHQId])
  @@index([eventMetaId])
  @@index([ownerId])
  @@index([personaId])
  @@index([status])
}

// Legacy model - will be removed after migration to contact_analyses
model bd_intels {
  id                    String   @id @default(cuid())
  personaId             String   @unique
  fitScore              Int
  painAlignmentScore    Int
  workflowFitScore      Int
  urgencyScore          Int
  adoptionBarrierScore  Int
  risks                 Json?
  opportunities         Json?
  recommendedTalkTrack  String?
  recommendedSequence   String?
  recommendedLeadSource String?
  finalSummary          String?
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  personas              personas @relation(fields: [personaId], references: [id], onDelete: Cascade)
}

// Contact Analysis - for REAL contacts (meeting prep), not hypothetical personas
model contact_analyses {
  id                    String   @id @default(cuid())
  contactId             String   @unique
  fitScore              Int?
  painAlignmentScore    Int?
  workflowFitScore      Int?
  urgencyScore          Int?
  adoptionBarrierScore  Int?
  risks                 Json?
  opportunities         Json?
  recommendedTalkTrack  String? // How to speak with THIS person
  recommendedSequence   String? // Outreach sequence for THIS person
  recommendedLeadSource String?
  finalSummary          String? // Prep summary for meeting
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  contacts              Contact  @relation(fields: [contactId], references: [id], onDelete: Cascade)

  @@index([contactId])
}

model bdos_scores {
  id               String   @id @default(cuid())
  contactId        String
  productId        String
  personaId        String?
  totalScore       Int
  personaFit       Int
  productFit       Int
  companyReadiness Int
  buyingPower      Int
  seniority        Int
  urgency          Int
  rationale        String?
  rawResponse      Json?
  createdAt        DateTime @default(now())

  @@index([contactId])
  @@index([createdAt])
  @@index([personaId])
  @@index([productId])
}

model blogs {
  id           String      @id @default(cuid())
  companyHQId  String
  title        String
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  blogText     String?
  description  String?
  presenter    String?
  sections     Json?
  subtitle     String?
  googleDocUrl String?
  company_hqs  company_hqs @relation(fields: [companyHQId], references: [id], onDelete: Cascade)

  @@index([companyHQId])
}

model campaigns {
  id               String             @id @default(cuid())
  owner_id         String
  company_hq_id    String?
  name             String
  description      String?
  status           CampaignStatus     @default(DRAFT)
  type             CampaignType       @default(EMAIL)
  subject          String?
  preview_text     String?
  from_email       String?
  from_name        String?
  scheduled_for    DateTime?
  started_at       DateTime?
  completed_at     DateTime?
  total_recipients Int                @default(0)
  emails_sent      Int                @default(0)
  emails_delivered Int                @default(0)
  emails_opened    Int                @default(0)
  emails_clicked   Int                @default(0)
  emails_replied   Int                @default(0)
  emails_bounced   Int                @default(0)
  open_rate        Float?
  click_rate       Float?
  reply_rate       Float?
  bounce_rate      Float?
  created_at       DateTime           @default(now())
  updated_at       DateTime
  contact_list_id  String?
  body             String?
  template_id      String?
  company_hqs      company_hqs?       @relation(fields: [company_hq_id], references: [id], onDelete: Cascade)
  contact_lists    contact_lists?     @relation(fields: [contact_list_id], references: [id])
  owners           owners             @relation(fields: [owner_id], references: [id], onDelete: Cascade)
  templates        templates?         @relation(fields: [template_id], references: [id])
  email_activities email_activities[]
  email_sequences  email_sequences[]
  emails           emails[]

  @@index([company_hq_id])
  @@index([contact_list_id])
  @@index([created_at])
  @@index([owner_id])
  @@index([status])
  @@index([template_id])
}

model client_uploads {
  id           String   @id @default(cuid())
  ownerId      String
  fileUrl      String
  originalName String
  fileType     String?
  size         Int?
  status       String   @default("stored")
  createdAt    DateTime @default(now())

  @@index([ownerId])
}

model companies {
  id                    String          @id @default(cuid())
  companyHQId           String
  companyName           String
  address               String?
  industry              String?
  website               String?
  revenue               Float?
  yearsInBusiness       Int?
  proposalId            String?
  contractId            String?
  invoiceId             String?
  createdAt             DateTime        @default(now())
  updatedAt             DateTime        @updatedAt
  category              String?
  companyHealthScore    Int?
  competitors           String[]        @default([])
  domain                String?         @unique
  fundingStage          String?
  growthRate            Float?
  growthScore           Int?
  headcount             Int?
  headcountTier         String?
  lastFundingAmount     Float?
  lastFundingDate       DateTime?
  marketPositionScore   Int?
  normalizedIndustry    String?
  numberOfFundingRounds Int?
  positioningLabel      String?
  readinessScore        Int?
  revenueRange          String?
  revenueTier           String?
  stabilityScore        Int?
  company_hqs           company_hqs     @relation(fields: [companyHQId], references: [id], onDelete: Cascade)
  contacts              Contact[]
  invoices              invoices[]
  proposals             proposals[]
  work_packages         work_packages[]

  @@index([domain])
}

model platform {
  id          String        @id @default(cuid())
  name        String
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  company_hqs company_hqs[]

  @@map("platform")
}

model company_hqs {
  id                                            String                          @id @default(cuid())
  companyName                                   String
  companyStreet                                 String?
  companyCity                                   String?
  companyState                                  String?
  companyZip                                    String?
  companyWebsite                                String?
  whatYouDo                                     String?
  companyIndustry                               String?
  teamSize                                      String?
  createdAt                                     DateTime                        @default(now())
  updatedAt                                     DateTime                        @updatedAt
  ownerId                                       String?
  contactOwnerId                                String?
  managerId                                     String?
  companyAnnualRev                              String?
  yearsInBusiness                               String?
  tier                                          String?
  stripeCustomerId                              String?                         @unique // Stripe customer ID (cus_...) - billing identity
  platformId                                    String? // Top-level platform container (temporarily optional for migration)
  platform                                      platform?                       @relation(fields: [platformId], references: [id], onDelete: Cascade)
  // Plan & Access (consolidated)
  planId                                        String? // FK â†’ Plan.id (temporarily optional for migration)
  planStatus                                    PlatformAccessStatus? // ACTIVE, PAST_DUE, CANCELED
  stripeSubscriptionId                          String?                         @unique // Stripe subscription ID (sub_...)
  planStartedAt                                 DateTime? // When plan access started
  planEndedAt                                   DateTime? // When plan access ends
  plans                                         plans?                          @relation(fields: [planId], references: [id])
  bills                                         bills[]
  company_retainers                             company_retainers[]
  assessments                                   assessments[]
  blogs                                         blogs[]
  campaigns                                     campaigns[]
  companies                                     companies[]
  contacts_company_hqs_contactOwnerIdTocontacts Contact?                        @relation("company_hqs_contactOwnerIdTocontacts", fields: [contactOwnerId], references: [id])
  owners_company_hqs_managerIdToowners          owners?                         @relation("company_hqs_managerIdToowners", fields: [managerId], references: [id])
  owners_company_hqs_ownerIdToowners            owners?                         @relation("company_hqs_ownerIdToowners", fields: [ownerId], references: [id])
  company_memberships                           company_memberships[]
  consultant_deliverables                       consultant_deliverables[]
  contact_lists                                 contact_lists[]
  contacts_contacts_crmIdTocompany_hqs          Contact[]                       @relation("contacts_crmIdTocompany_hqs")
  deliverable_templates                         deliverable_templates[]
  domain_registry                               domain_registry?
  email_sequences                               email_sequences[]
  invoices                                      invoices[]
  income                                        income[]
  invoice_settings                              invoice_settings?
  invoice_templates                             invoice_templates[]
  landing_pages                                 landing_pages[]
  personas                                      personas[]
  phase_templates                               phase_templates[]
  presentations                                 presentations[]
  products                                      products[]
  proposals                                     proposals[]
  template_relationship_helpers                 template_relationship_helpers[]
  templates                                     templates[]
  template_snippets                             template_snippets[]
  work_packages                                 work_packages[]
  financials                                    financials?
  templateVariables                             template_variables[]

  @@index([stripeCustomerId])
  @@index([platformId])
  @@index([planId])
  @@index([planStatus])
  @@index([stripeSubscriptionId])
}

model company_memberships {
  id          String      @id @default(cuid())
  userId      String
  companyHqId String
  role        String
  createdAt   DateTime    @default(now())
  company_hqs company_hqs @relation(fields: [companyHqId], references: [id], onDelete: Cascade)
  owners      owners      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, companyHqId])
  @@index([companyHqId])
  @@index([userId, companyHqId])
  @@index([userId])
}

model consultant_deliverables {
  id               String      @id @default(cuid())
  contactId        String
  title            String
  description      String?
  category         String?
  type             String?
  workContent      Json?
  status           String      @default("pending")
  proposalId       String?
  milestoneId      String?
  dueDate          DateTime?
  completedAt      DateTime?
  notes            String?
  companyHQId      String
  contactCompanyId String?
  createdAt        DateTime    @default(now())
  updatedAt        DateTime    @updatedAt
  company_hqs      company_hqs @relation(fields: [companyHQId], references: [id], onDelete: Cascade)
  contacts         Contact     @relation(fields: [contactId], references: [id], onDelete: Cascade)
  proposals        proposals?  @relation(fields: [proposalId], references: [id])

  @@index([companyHQId])
  @@index([contactId])
  @@index([proposalId])
}

model contact_lists {
  id            String      @id @default(cuid())
  companyId     String
  name          String
  description   String?
  type          String      @default("static")
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  filters       Json?
  totalContacts Int         @default(0)
  lastUpdated   DateTime    @default(now())
  isActive      Boolean     @default(true)
  campaigns     campaigns[]
  company_hqs   company_hqs @relation(fields: [companyId], references: [id], onDelete: Cascade)
  contacts      Contact[]

  @@unique([companyId, name])
  @@index([companyId])
  @@index([isActive])
}

model Contact {
  id                                                        String                     @id @default(cuid())
  crmId                                                     String
  firstName                                                 String?
  lastName                                                  String?
  fullName                                                  String?
  goesBy                                                    String?
  email                                                     String?
  phone                                                     String?
  title                                                     String?
  seniority                                                 String?
  department                                                String?
  linkedinUrl                                               String?
  linkedinConnectedOn                                       String? // LinkedIn "Connected On" context, e.g. "Jan 2024"
  city                                                      String?
  state                                                     String?
  country                                                   String?
  companyName                                               String?
  companyDomain                                             String?
  positionType                                              String? // "VP", "Director", "Manager", etc.
  contactCompanyId                                          String?
  howMet                                                    String?
  notes                                                     String?
  contactListId                                             String?
  domain                                                    String?
  enrichmentSource                                          String?
  enrichmentFetchedAt                                       DateTime?
  enrichmentPayload                                         Json?
  createdById                                               String?
  firebaseUid                                               String?                    @unique
  clientPortalUrl                                           String?                    @default("https://clientportal.ignitegrowth.biz")
  isActivated                                               Boolean                    @default(false)
  activatedAt                                               DateTime?
  ownerId                                                   String?
  role                                                      String                     @default("contact")
  createdAt                                                 DateTime                   @default(now())
  updatedAt                                                 DateTime                   @updatedAt
  averageTenureMonths                                       Float?
  avgTenureYears                                            Float?
  budgetAuthority                                           Boolean?
  buyerLikelihoodScore                                      Int?
  buyingPowerScore                                          Int?
  buyingTriggers                                            String[]                   @default([])
  careerMomentumScore                                       Int?
  careerMomentum                                            String? // "high" | "medium" | "low" (inferred from signals)
  careerProgression                                         String?
  careerStabilityScore                                      Int?
  whatTheyreLookingFor                                      String? // Inferred: "growth", "stability", "opportunity", etc.
  careerTimeline                                            Json?
  companyId                                                 String?
  companyIndustry                                           String?
  companySize                                               String?
  currentRoleStartDate                                      DateTime?
  currentTenureYears                                        Float?
  decisionMaker                                             Boolean?
  enrichmentRedisKey                                        String?
  gatekeeper                                                Boolean?
  goals                                                     String[]                   @default([])
  influencer                                                Boolean?
  jobRole                                                   String?
  numberOfJobChanges                                        Int?
  painPoints                                                String[]                   @default([])
  profileSummary                                            String?
  readinessToBuyScore                                       Int?
  recentJobChange                                           Boolean?
  recentPromotion                                           Boolean?
  rolePowerScore                                            Int?
  seniorityScore                                            Int?
  tenureYears                                               Int?
  timezone                                                  String?
  totalExperienceYears                                      Float?
  totalYearsExperience                                      Float?
  urgencyScore                                              Int?
  buyingReadiness                                           BuyingReadiness?
  buyerPerson                                               BuyerPerson?
  // Manual outreach tracking fields
  persona_type                                              PersonaType?
  prior_relationship                                        RelationshipEnum?
  lastContact                                               String? // Manual: "Aug 2025", "Last week", etc.
  remindMeOn                                                DateTime? // Manual reminder: "remind me to contact on April 1"
  outreachPersonaSlug                                       String? // Assigned outreach persona (e.g., "FormerColleagueNowReachingoutAgainAfterLongTime")
  company_hqs_company_hqs_contactOwnerIdTocontacts          company_hqs[]              @relation("company_hqs_contactOwnerIdTocontacts")
  consultant_deliverables                                   consultant_deliverables[]
  companies                                                 companies?                 @relation(fields: [contactCompanyId], references: [id])
  contact_lists                                             contact_lists?             @relation(fields: [contactListId], references: [id])
  company_hqs_contacts_crmIdTocompany_hqs                   company_hqs                @relation("contacts_crmIdTocompany_hqs", fields: [crmId], references: [id])
  outreach_personas                                         outreach_personas?         @relation(fields: [outreachPersonaSlug], references: [slug], onDelete: SetNull)
  invoices                                                  invoices[]
  invite_tokens                                             invite_tokens[]
  pipelines                                                 pipelines?
  proposals                                                 proposals[]
  work_packages_work_packages_workPackageClientIdTocontacts work_packages[]            @relation("work_packages_workPackageClientIdTocontacts")
  work_packages_work_packages_workPackageMemberIdTocontacts work_packages[]            @relation("work_packages_workPackageMemberIdTocontacts")
  contact_analyses                                          contact_analyses?
  off_platform_email_sends                                  off_platform_email_sends[]
  emails                                                    emails[]

  @@unique([email, crmId])
  @@index([companyDomain])
  @@index([companyId])
  @@index([domain])
  @@index([email])
  @@index([firebaseUid])
  @@index([ownerId])
  @@index([role])
  @@index([prior_relationship])
  @@index([remindMeOn])
  @@map("contacts")
}

model deliverable_templates {
  id                          String                        @id @default(cuid())
  companyHQId                 String
  deliverableType             String
  deliverableLabel            String
  defaultUnitOfMeasure        String
  defaultDuration             Int
  createdAt                   DateTime                      @default(now())
  company_hqs                 company_hqs                   @relation(fields: [companyHQId], references: [id], onDelete: Cascade)
  phase_deliverable_templates phase_deliverable_templates[]

  @@unique([companyHQId, deliverableType])
  @@index([companyHQId])
}

model domain_registry {
  id              String      @id @default(cuid())
  domain          String      @unique
  normalizedName  String?
  companyHqId     String      @unique
  firstSeen       DateTime    @default(now())
  lastSeen        DateTime
  confidenceScore Float?      @default(1.0)
  company_hqs     company_hqs @relation(fields: [companyHqId], references: [id], onDelete: Cascade)

  @@index([companyHqId])
  @@index([domain])
}

model ecosystem_orgs {
  id                          String                @id @default(cuid())
  name                        String
  website                     String?
  city                        String?
  state                       String?
  archetype                   OrganizationArchetype
  whatTheyDo                  String?
  annualRevenue               Int?
  duesInfo                    String?
  memberCount                 Int?
  memberDescription           String?
  memberSeniority             String?
  memberIndustries            String[]
  memberReasonForAffiliation  String?
  memberAffiliationStrength   String?
  orgRelevanceToCompanyHQ     String?
  bdCompanyHQAffiliationScore Int?
  targetPersonaAlignment      Int?
  createdAt                   DateTime              @default(now())

  @@index([archetype])
  @@index([name])
}

model email_activities {
  id                  String           @id @default(cuid())
  owner_id            String
  contact_id          String?
  tenant_id           String?
  email               String
  subject             String
  body                String
  event               String?
  messageId           String           @unique
  createdAt           DateTime         @default(now())
  updatedAt           DateTime         @updatedAt
  campaign_id         String?
  sequence_id         String?
  sequence_step_id    String?
  reply_to_message_id String?
  campaigns           campaigns?       @relation(fields: [campaign_id], references: [id])
  owners              owners           @relation(fields: [owner_id], references: [id], onDelete: Cascade)
  email_sequences     email_sequences? @relation(fields: [sequence_id], references: [id])
  sequence_steps      sequence_steps?  @relation(fields: [sequence_step_id], references: [id])
  emails              emails?          @relation("EmailActivityToEmail")

  @@index([campaign_id])
  @@index([contact_id, createdAt])
  @@index([contact_id])
  @@index([messageId])
  @@index([owner_id])
  @@index([sequence_id])
}

model email_sequences {
  id                  String             @id @default(cuid())
  campaign_id         String?
  owner_id            String
  company_hq_id       String?
  name                String
  description         String?
  status              SequenceStatus     @default(DRAFT)
  auto_pause_on_reply Boolean            @default(true)
  total_recipients    Int                @default(0)
  emails_sent         Int                @default(0)
  emails_opened       Int                @default(0)
  emails_clicked      Int                @default(0)
  emails_replied      Int                @default(0)
  open_rate           Float?
  click_rate          Float?
  reply_rate          Float?
  created_at          DateTime           @default(now())
  updated_at          DateTime
  email_activities    email_activities[]
  campaigns           campaigns?         @relation(fields: [campaign_id], references: [id])
  company_hqs         company_hqs?       @relation(fields: [company_hq_id], references: [id], onDelete: Cascade)
  owners              owners             @relation(fields: [owner_id], references: [id], onDelete: Cascade)
  sequence_steps      sequence_steps[]

  @@index([campaign_id])
  @@index([owner_id])
  @@index([status])
}

model email_signatures {
  id         String   @id @default(cuid())
  owner_id   String
  name       String
  content    String
  is_default Boolean  @default(false)
  created_at DateTime @default(now())
  updated_at DateTime
  owners     owners   @relation(fields: [owner_id], references: [id], onDelete: Cascade)

  @@index([owner_id])
  @@index([owner_id, is_default])
}

model event_metas {
  id               String             @id @default(cuid())
  name             String
  seriesName       String?
  eventType        EventType
  organizerId      String?
  city             String?
  state            String?
  country          String?
  startDate        DateTime?
  endDate          DateTime?
  dateRange        String?
  costMin          Int?
  costMax          Int?
  currency         String?
  sourceType       EventSourceType    @default(AI)
  rawJson          Json?
  createdAt        DateTime           @default(now())
  bd_eventop_intel bd_eventop_intel[]

  @@index([eventType])
  @@index([name])
  @@index([organizerId])
}

model event_plan_opps {
  id           String       @id @default(cuid())
  eventPlanId  String
  bdEventOppId String
  order        Int?
  createdAt    DateTime     @default(now())
  bd_event_ops bd_event_ops @relation(fields: [bdEventOppId], references: [id], onDelete: Cascade)

  @@unique([eventPlanId, bdEventOppId])
  @@index([bdEventOppId])
  @@index([eventPlanId])
}

model event_plans {
  id           String   @id @default(cuid())
  companyHQId  String
  description  String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  name         String
  ownerId      String
  presenter    String?
  spacingScore Int?
  totalCost    Int?
  totalTrips   Int?
  year         Int?

  @@index([companyHQId])
  @@index([ownerId])
}

model event_tuner_personas {
  id           String       @id @default(cuid())
  eventTunerId String
  personaId    String
  createdAt    DateTime     @default(now())
  event_tuners event_tuners @relation(fields: [eventTunerId], references: [id], onDelete: Cascade)
  personas     personas     @relation(fields: [personaId], references: [id], onDelete: Cascade)

  @@unique([eventTunerId, personaId])
  @@index([eventTunerId])
  @@index([personaId])
}

model event_tuner_states {
  id           String       @id @default(cuid())
  eventTunerId String
  state        String
  createdAt    DateTime     @default(now())
  event_tuners event_tuners @relation(fields: [eventTunerId], references: [id], onDelete: Cascade)

  @@unique([eventTunerId, state])
  @@index([eventTunerId])
  @@index([state])
}

model event_tuners {
  id                    String                 @id @default(cuid())
  companyHQId           String
  ownerId               String
  name                  String
  conferencesPerQuarter Int?
  costRange             EventCostRange?
  eventSearchRawText    String?
  travelDistance        TravelDistance?
  isActive              Boolean                @default(true)
  createdAt             DateTime               @default(now())
  updatedAt             DateTime               @updatedAt
  bd_event_ops          bd_event_ops[]
  event_tuner_personas  event_tuner_personas[]
  event_tuner_states    event_tuner_states[]

  @@index([companyHQId])
  @@index([isActive])
  @@index([ownerId])
}

model invite_tokens {
  id        String   @id @default(cuid())
  contactId String
  email     String
  token     String   @unique
  expiresAt DateTime
  used      Boolean  @default(false)
  createdAt DateTime @default(now())
  contacts  Contact  @relation(fields: [contactId], references: [id], onDelete: Cascade)

  @@index([contactId])
  @@index([email])
  @@index([token])
}

model invoice_milestones {
  id             String     @id @default(cuid())
  invoiceId      String
  label          String
  expectedAmount Int
  expectedDate   DateTime?
  description    String?
  status         String     @default("pending")
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt
  invoices       invoices   @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  payments       payments[]

  @@index([invoiceId])
  @@index([status])
}

model invoice_template_milestones {
  id                String            @id @default(cuid())
  templateId        String
  label             String
  expectedAmount    Float
  expectedDate      DateTime?
  description       String?
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  invoice_templates invoice_templates @relation(fields: [templateId], references: [id], onDelete: Cascade)

  @@index([templateId])
}

model invoice_templates {
  id                          String                        @id @default(cuid())
  companyHQId                 String
  name                        String
  notes                       String?
  createdAt                   DateTime                      @default(now())
  updatedAt                   DateTime                      @updatedAt
  invoice_template_milestones invoice_template_milestones[]
  company_hqs                 company_hqs                   @relation(fields: [companyHQId], references: [id], onDelete: Cascade)

  @@unique([companyHQId, name])
  @@index([companyHQId])
}

model invoice_settings {
  id                          String      @id @default(cuid())
  companyHQId                 String      @unique
  invoicePrefix               String?
  invoiceNumberFormat         String?
  defaultCurrency             String      @default("USD")
  defaultPaymentTerms         String?
  defaultNotes                String?
  taxId                       String?
  billingAddress              String?
  billingEmail                String?
  autoGenerateNumber          Boolean     @default(true)
  nextInvoiceNumber           Int         @default(1)
  platformFeeAmount           Int?
  platformFeeDescription      String?
  monthlyRecurringAmount      Int?
  monthlyRecurringDescription String?
  createdAt                   DateTime    @default(now())
  updatedAt                   DateTime    @updatedAt
  company_hqs                 company_hqs @relation(fields: [companyHQId], references: [id], onDelete: Cascade)

  @@index([companyHQId])
}

model invoices {
  id String @id @default(cuid())

  // Company/Platform Scope
  companyHQId String

  // Invoice Type & Classification
  invoiceType        InvoiceType
  invoiceName        String
  invoiceDescription String?
  invoiceNumber      String?

  // Legacy Work Package Link (for migrated invoices)
  workPackageId String?

  // Client/Contact Information
  contactId String?
  companyId String?

  // Amounts & Currency
  totalExpected Int    @default(0)
  totalReceived Int    @default(0)
  currency      String @default("USD")
  amount        Float?

  // Status
  status InvoiceStatus @default(NOT_PAID)

  // Recurring Invoice Fields (for MONTHLY_RECURRING type)
  isRecurring        Boolean   @default(false)
  recurringFrequency String?
  nextBillingDate    DateTime?
  lastBilledDate     DateTime?

  // Payment Tracking
  paidAt                  DateTime?
  paidByContactId         String?
  stripeCheckoutSessionId String?
  stripePaymentIntentId   String?
  stripeCustomerId        String?
  stripeInvoiceId         String?   @unique // Stripe invoice ID (in_...) for plan subscriptions
  stripeSubscriptionId    String? // Stripe subscription ID (sub_...) for plan subscriptions

  // Timestamps
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  dueDate   DateTime?

  // Relations
  invoice_milestones invoice_milestones[]
  work_packages      work_packages?       @relation(fields: [workPackageId], references: [id], onDelete: SetNull)
  company_hqs        company_hqs          @relation(fields: [companyHQId], references: [id], onDelete: Cascade)
  contacts           Contact?             @relation(fields: [contactId], references: [id])
  companies          companies?           @relation(fields: [companyId], references: [id])
  payments           payments[]
  income             income[]

  @@index([status])
  @@index([invoiceType])
  @@index([companyHQId])
  @@index([workPackageId])
  @@index([contactId])
  @@index([companyId])
  @@index([stripeCustomerId])
  @@index([stripeInvoiceId])
  @@index([stripeSubscriptionId])
  @@index([isRecurring])
  @@index([nextBillingDate])
}

model landing_pages {
  id          String      @id @default(cuid())
  companyHQId String
  title       String
  url         String?
  content     Json?
  description String?
  published   Boolean     @default(false)
  publishedAt DateTime?
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  presenter   String?
  company_hqs company_hqs @relation(fields: [companyHQId], references: [id], onDelete: Cascade)

  @@index([companyHQId])
  @@index([published])
}

model owners {
  id                                        String                @id @default(cuid())
  firebaseId                                String                @unique
  name                                      String?
  email                                     String?
  photoURL                                  String?
  teamSize                                  String?
  createdAt                                 DateTime              @default(now())
  updatedAt                                 DateTime              @updatedAt
  firstName                                 String?
  lastName                                  String?
  sendgridVerifiedEmail                     String?
  sendgridVerifiedName                      String?
  tier                                      String?               @default("foundation")
  GoogleOAuthToken                          GoogleOAuthToken[]
  MicrosoftAccount                          MicrosoftAccount?
  assessments                               assessments[]
  campaigns                                 campaigns[]
  company_hqs_company_hqs_managerIdToowners company_hqs[]         @relation("company_hqs_managerIdToowners")
  company_hqs_company_hqs_ownerIdToowners   company_hqs[]         @relation("company_hqs_ownerIdToowners")
  company_memberships                       company_memberships[]
  email_activities                          email_activities[]
  email_sequences                           email_sequences[]
  email_signatures                          email_signatures[]
  templates                                 templates[]
}

model payments {
  id                    String              @id @default(cuid())
  invoiceId             String
  milestoneId           String?
  amountReceived        Int
  currency              String              @default("USD")
  paidAt                DateTime
  stripeSessionId       String?             @unique
  stripePaymentIntentId String?             @unique
  paidByContactId       String?
  createdAt             DateTime            @default(now())
  invoices              invoices            @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  invoice_milestones    invoice_milestones? @relation(fields: [milestoneId], references: [id])

  @@index([invoiceId])
  @@index([milestoneId])
  @@index([stripePaymentIntentId])
  @@index([stripeSessionId])
}

model personas {
  id                   String                 @id @default(cuid())
  companyHQId          String
  personName           String                 @default("")
  title                String
  headline             String?
  seniority            String?
  role                 String? // Additional role context (more than just title)
  industry             String?
  subIndustries        String[]
  company              String?
  companySize          String?
  annualRevenue        String?
  location             String?
  description          String?
  whatTheyWant         String? // Legacy field - use needForOurProduct
  coreGoal             String? // Their north star (regardless of our product)
  needForOurProduct    String? // Need for OUR PRODUCT assessment (key field!)
  potentialPitch       String? // How we would pitch (inferred)
  painPoints           String[]
  risks                String[]
  decisionDrivers      String[]
  buyerTriggers        String[]
  createdAt            DateTime               @default(now())
  updatedAt            DateTime               @updatedAt
  productId            String?
  bd_intels            bd_intels? // Legacy - will be removed after migration
  event_tuner_personas event_tuner_personas[]
  company_hqs          company_hqs            @relation(fields: [companyHQId], references: [id], onDelete: Cascade)
  products             products?              @relation(fields: [productId], references: [id])
  product_fits         product_fits?
}

model phase_deliverable_templates {
  id                    String                @id @default(cuid())
  phaseTemplateId       String
  deliverableTemplateId String
  defaultQuantity       Int?                  @default(1)
  order                 Int?                  @default(0)
  createdAt             DateTime              @default(now())
  deliverable_templates deliverable_templates @relation(fields: [deliverableTemplateId], references: [id], onDelete: Cascade)
  phase_templates       phase_templates       @relation(fields: [phaseTemplateId], references: [id], onDelete: Cascade)

  @@unique([phaseTemplateId, deliverableTemplateId])
}

model phase_templates {
  id                          String                        @id @default(cuid())
  companyHQId                 String
  name                        String
  description                 String?
  createdAt                   DateTime                      @default(now())
  phase_deliverable_templates phase_deliverable_templates[]
  company_hqs                 company_hqs                   @relation(fields: [companyHQId], references: [id], onDelete: Cascade)
  proposal_phases             proposal_phases[]

  @@unique([companyHQId, name])
  @@index([companyHQId])
}

model pipelines {
  id        String   @id @default(cuid())
  contactId String   @unique
  pipeline  String
  stage     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  contacts  Contact  @relation(fields: [contactId], references: [id], onDelete: Cascade)
}

model presentations {
  id                String      @id @default(cuid())
  companyHQId       String
  title             String
  description       String?
  slides            Json?
  published         Boolean     @default(false)
  publishedAt       DateTime?
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
  feedback          Json?
  gammaBlob         String?
  gammaDeckUrl      String?
  gammaError        String?
  gammaPptxUrl      String?
  gammaStatus       String?
  presenter         String?
  gammaGenerationId String?
  company_hqs       company_hqs @relation(fields: [companyHQId], references: [id], onDelete: Cascade)

  @@index([companyHQId])
  @@index([published])
}

model product_fits {
  id                 String   @id @default(cuid())
  personaId          String   @unique
  productId          String
  valuePropToThem    String
  alignmentReasoning String
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  personas           personas @relation(fields: [personaId], references: [id], onDelete: Cascade)
  products           products @relation(fields: [productId], references: [id], onDelete: Cascade)
}

model products {
  id                    String         @id @default(cuid())
  companyHQId           String
  name                  String
  description           String?
  valueProp             String?
  price                 Float?
  priceCurrency         String?        @default("USD")
  pricingModel          String?
  category              String?
  deliveryTimeline      String?
  targetMarketSize      String?
  salesCycleLength      String?
  features              String?
  competitiveAdvantages String?
  targetedTo            String?
  createdAt             DateTime       @default(now())
  updatedAt             DateTime       @updatedAt
  personas              personas[]
  product_fits          product_fits[]
  company_hqs           company_hqs    @relation(fields: [companyHQId], references: [id], onDelete: Cascade)
}

model proposal_deliverables {
  id          String    @id @default(cuid())
  proposalId  String
  name        String
  description String?
  quantity    Int       @default(1)
  unitPrice   Float?
  totalPrice  Float?
  notes       String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  proposals   proposals @relation(fields: [proposalId], references: [id], onDelete: Cascade)

  @@index([proposalId])
}

model proposal_phases {
  id              String           @id @default(cuid())
  proposalId      String
  phaseTemplateId String?
  name            String
  description     String?
  durationWeeks   Int
  order           Int
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  phase_templates phase_templates? @relation(fields: [phaseTemplateId], references: [id])
  proposals       proposals        @relation(fields: [proposalId], references: [id], onDelete: Cascade)

  @@index([proposalId])
}

model proposals {
  id                      String                    @id @default(cuid())
  title                   String
  companyHQId             String
  contactId               String
  companyId               String
  estimatedStart          DateTime
  status                  String                    @default("draft")
  totalPrice              Float?
  purpose                 String?
  phases                  Json?
  milestones              Json?
  compensation            Json?
  dateIssued              DateTime?
  preparedBy              String?
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime                  @updatedAt
  consultant_deliverables consultant_deliverables[]
  proposal_deliverables   proposal_deliverables[]
  proposal_phases         proposal_phases[]
  company_hqs             company_hqs               @relation(fields: [companyHQId], references: [id], onDelete: Cascade)
  companies               companies                 @relation(fields: [companyId], references: [id], onDelete: Cascade)
  contacts                Contact                   @relation(fields: [contactId], references: [id], onDelete: Cascade)
}

model prospect_candidates {
  id          String   @id @default(cuid())
  userId      String
  firstName   String?
  lastName    String?
  companyName String?
  domain      String?
  status      String   @default("pending")
  createdAt   DateTime @default(now())

  @@index([status])
  @@index([userId])
}

model saved_events {
  id               String   @id @default(cuid())
  userId           String
  eventName        String
  eventSeriesName  String?
  organizerName    String
  producerType     String
  city             String
  stateOrRegion    String?
  startDate        String?
  endDate          String?
  costMin          Int?
  costMax          Int?
  currency         String
  personaAlignment Int
  url              String?
  rawJson          Json
  createdAt        DateTime @default(now())

  @@index([createdAt])
  @@index([userId])
}

model sequence_steps {
  id               String             @id @default(cuid())
  sequence_id      String
  step_number      Int
  name             String?
  subject          String
  body             String
  delay_days       Int                @default(0)
  delay_hours      Int                @default(0)
  conditions       Json?
  from_email       String?
  from_name        String?
  total_sent       Int                @default(0)
  total_opened     Int                @default(0)
  total_clicked    Int                @default(0)
  total_replied    Int                @default(0)
  open_rate        Float?
  click_rate       Float?
  reply_rate       Float?
  created_at       DateTime           @default(now())
  updated_at       DateTime
  email_activities email_activities[]
  email_sequences  email_sequences    @relation(fields: [sequence_id], references: [id], onDelete: Cascade)

  @@unique([sequence_id, step_number])
  @@index([sequence_id])
  @@index([sequence_id, step_number])
}

model template_relationship_helpers {
  id               String      @id @default(cuid())
  ownerId          String
  relationshipType String
  familiarityLevel String
  whyReachingOut   String
  desiredOutcome   String?
  timeHorizon      String?
  contextNotes     String?
  createdAt        DateTime    @default(now())
  company_hqs      company_hqs @relation(fields: [ownerId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([ownerId])
}

model templates {
  id          String      @id @default(cuid())
  subject     String
  body        String
  createdAt   DateTime    @default(now())
  companyHQId String // Required - company-scoped (matches phase_templates pattern)
  title       String
  ownerId     String? // Optional - creator/audit trail
  campaigns   campaigns[]
  company_hqs company_hqs @relation(fields: [companyHQId], references: [id], onDelete: Cascade)
  owners      owners?     @relation(fields: [ownerId], references: [id], onDelete: SetNull)

  @@index([companyHQId])
  @@index([ownerId])
}

model template_snippets {
  id           String      @id @default(cuid())
  companyHQId  String
  variableName String // e.g. intent_reach_out, mypitch, warm_intro
  name         String // Human-readable label
  intentType   String? // e.g. reactivation, prior_contact, intro_positioning, seasonal, neutral_polite
  body         String      @db.Text // Snippet content (can include {{firstName}}, {firm_name}, etc.)
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  company_hqs  company_hqs @relation(fields: [companyHQId], references: [id], onDelete: Cascade)

  @@unique([companyHQId, variableName])
  @@index([companyHQId])
}

// Relationship context - foundational info about WHO the persona is
model relationship_contexts {
  relationshipContextId String                @id @default(cuid())
  contextOfRelationship ContextOfRelationship
  relationshipRecency   RelationshipRecency
  companyAwareness      CompanyAwareness
  contextKey            String                @unique // e.g., PRIOR_COLLEAGUE_LONG_DORMANT_KNOWS_COMPANY
  createdAt             DateTime              @default(now())
  updatedAt             DateTime              @updatedAt

  @@index([contextKey])
  @@index([contextOfRelationship, relationshipRecency, companyAwareness])
}

// Simple outreach personas - descriptive slugs that drive snippet assembly
// Example: "FormerColleagueNowReachingoutAgainAfterLongTime"
model outreach_personas {
  id          String    @id @default(cuid())
  slug        String    @unique // e.g., "FormerColleagueNowReachingoutAgainAfterLongTime"
  name        String // Display name: "Former Colleague - Long Time"
  description String?   @db.Text // What this persona represents
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  contacts    Contact[]

  @@index([slug])
}

// ContentSnip: hydration-friendly snippet library (CSV/manual), use in templates as {{snippet:snipSlug}}
// templatePosition = where in the template; personaSlug / bestUsedWhen = usage guidance for assembly
model ContentSnip {
  snipId           String           @id @default(cuid())
  snipName         String
  snipSlug         String           @unique
  snipText         String           @db.Text
  templatePosition TemplatePosition
  personaSlug      String?
  bestUsedWhen     String?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt

  @@map("content_snips")
  @@index([templatePosition])
}

model template_variables {
  id           String      @id @default(cuid())
  companyHQId  String
  variableKey  String // unique per company; used as {{variableKey}} in templates
  description  String?     @db.Text // Human-readable description
  source       String // CONTACT | OWNER | COMPUTED | CUSTOM
  dbField      String? // Field name in source (e.g., 'firstName' for CONTACT source)
  computedRule String?     @db.Text // For COMPUTED or CUSTOM: how to compute the value
  isBuiltIn    Boolean     @default(false) // true for standard variables (firstName, etc.)
  isActive     Boolean     @default(true)
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  company_hqs  company_hqs @relation(fields: [companyHQId], references: [id], onDelete: Cascade)

  @@unique([companyHQId, variableKey])
  @@index([companyHQId])
  @@index([companyHQId, source])
  @@index([companyHQId, isActive])
  @@index([companyHQId, isBuiltIn])
}

model work_collateral {
  id                String               @id @default(cuid())
  workPackageId     String?
  workPackageItemId String?
  presentationId    String?
  type              String
  title             String?
  contentJson       Json?
  status            WorkCollateralStatus @default(IN_PROGRESS)
  reviewRequestedAt DateTime?
  reviewCompletedAt DateTime?
  createdAt         DateTime             @default(now())
  updatedAt         DateTime             @updatedAt

  @@index([presentationId])
  @@index([status])
  @@index([type])
  @@index([workPackageId])
  @@index([workPackageItemId])
}

model work_package_items {
  id                     String                @id @default(cuid())
  workPackageId          String
  workPackagePhaseId     String
  deliverableType        String
  deliverableLabel       String
  deliverableDescription String?
  itemType               String                @default("")
  itemLabel              String                @default("")
  itemDescription        String?
  quantity               Int
  unitOfMeasure          String
  estimatedHoursEach     Int
  duration               Int?
  createdAt              DateTime              @default(now())
  status                 WorkPackageItemStatus @default(NOT_STARTED)
  work_packages          work_packages         @relation(fields: [workPackageId], references: [id], onDelete: Cascade)
  work_package_phases    work_package_phases   @relation(fields: [workPackagePhaseId], references: [id], onDelete: Cascade)

  @@unique([workPackageId, workPackagePhaseId, deliverableLabel])
  @@index([deliverableType])
  @@index([itemType])
  @@index([workPackageId])
  @@index([workPackagePhaseId])
}

model work_package_phases {
  id                  String               @id @default(cuid())
  workPackageId       String
  name                String
  position            Int
  description         String?
  phaseTotalDuration  Int?
  totalEstimatedHours Int?
  createdAt           DateTime             @default(now())
  actualEndDate       DateTime?
  actualStartDate     DateTime?
  estimatedEndDate    DateTime?
  estimatedStartDate  DateTime?
  status              String?
  updatedAt           DateTime             @default(now()) @updatedAt
  work_package_items  work_package_items[]
  work_packages       work_packages        @relation(fields: [workPackageId], references: [id], onDelete: Cascade)

  @@unique([workPackageId, name, position])
  @@index([position])
  @@index([workPackageId])
}

model work_packages {
  id                                                   String                @id @default(cuid())
  companyId                                            String
  title                                                String
  description                                          String?
  prioritySummary                                      String?
  totalCost                                            Float?
  effectiveStartDate                                   DateTime?
  createdAt                                            DateTime              @default(now())
  updatedAt                                            DateTime              @updatedAt
  workPackageOwnerId                                   String
  workPackageClientId                                  String
  workPackageMemberId                                  String?
  metadata                                             Json?
  tags                                                 String[]              @default([])
  status                                               WorkPackageStatus     @default(ACTIVE)
  invoices                                             invoices[]
  work_package_items                                   work_package_items[]
  work_package_phases                                  work_package_phases[]
  companies                                            companies             @relation(fields: [companyId], references: [id], onDelete: Cascade)
  contacts_work_packages_workPackageClientIdTocontacts Contact               @relation("work_packages_workPackageClientIdTocontacts", fields: [workPackageClientId], references: [id])
  contacts_work_packages_workPackageMemberIdTocontacts Contact?              @relation("work_packages_workPackageMemberIdTocontacts", fields: [workPackageMemberId], references: [id])
  company_hqs                                          company_hqs           @relation(fields: [workPackageOwnerId], references: [id])

  @@index([companyId])
  @@index([status])
  @@index([workPackageClientId])
  @@index([workPackageMemberId])
  @@index([workPackageOwnerId])
}

model plans {
  id              String        @id @default(cuid())
  name            String // e.g., "Gold Tier â€“ Annual"
  description     String?
  interval        PlanInterval? // "month" | "year" | null (for one-time)
  amountCents     Int // Price in cents
  currency        String        @default("usd")
  stripeProductId String? // prod_...
  stripePriceId   String?       @unique // price_... (1:1 with Plan)
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  company_hqs     company_hqs[] // Companies using this plan

  @@index([stripeProductId])
  @@index([stripePriceId])
}

// One-off billing (ONE_OFF_BILLING.md). Same shape as plans, no interval. Platform push.
model bills {
  id                      String         @id @default(cuid())
  name                    String
  description             String?
  amountCents             Int
  currency                String         @default("usd")
  companyId               String? // FK â†’ company_hqs.id (many bills â†’ one company)
  stripeCheckoutSessionId String?        @unique
  checkoutUrl             String?
  status                  BillSendStatus @default(PENDING)
  slug                    String?        @unique
  publicBillUrl           String?
  paidAt                  DateTime? // When payment was received (set by Stripe webhook)
  createdAt               DateTime       @default(now())
  updatedAt               DateTime       @updatedAt
  company_hqs             company_hqs?   @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([status])
  @@index([slug])
  @@index([paidAt])
}

// Company-specific recurring retainers (isolated from universal plan model).
model company_retainers {
  id                   String           @id @default(cuid())
  companyId            String
  name                 String
  description          String?
  amountCents          Int
  currency             String           @default("usd")
  interval             RetainerInterval @default(MONTH)
  startDate            DateTime?
  status               RetainerStatus   @default(DRAFT)
  slug                 String?          @unique
  publicRetainerUrl    String?
  stripeSubscriptionId String?          @unique
  activatedAt          DateTime?
  paidAt               DateTime?
  canceledAt           DateTime?
  createdAt            DateTime         @default(now())
  updatedAt            DateTime         @updatedAt

  company_hqs company_hqs @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([status])
  @@index([slug])
  @@index([stripeSubscriptionId])
}

enum BillSendStatus {
  PENDING
  PAID
  EXPIRED
}

enum RetainerStatus {
  DRAFT
  LINK_SENT
  ACTIVE
  PAST_DUE
  CANCELED
  EXPIRED
}

enum RetainerInterval {
  MONTH
}

// PlatformAccess removed - consolidated into company_hqs fields:
// - planId (optional FK to Plan)
// - planStatus (PlatformAccessStatus)
// - stripeSubscriptionId
// - planStartedAt
// - planEndedAt

enum BuyerPerson {
  BUSINESS_OWNER
  DIRECTOR_VP
  PRODUCT_USER
}

enum BuyingReadiness {
  NOT_READY
  READY_NO_MONEY
  READY_WITH_MONEY
}

enum CampaignStatus {
  DRAFT
  SCHEDULED
  ACTIVE
  PAUSED
  COMPLETED
  CANCELLED
}

enum CampaignType {
  EMAIL
  SEQUENCE
  ONE_OFF
}

enum EventCostRange {
  FREE
  LOW_0_500
  MEDIUM_500_2000
  HIGH_2000_5000
  PREMIUM_5000_PLUS
  NO_LIMIT
}

enum EventOppStatus {
  CONSIDERING
  SHORTLIST
  GOING
  PASSED
}

enum EventSource {
  PERSONA
  USER_PREF
  MANUAL
  BD_INTEL
}

enum EventSourceType {
  AI
  CSV
  MANUAL
  WEB
}

enum EventType {
  ASSOCIATION
  COMMERCIAL
  MEDIA
  INDUSTRY
  PRIVATE
  CORPORATE
}

enum OrganizationArchetype {
  ASSOCIATION
  TRADE_GROUP
  GUILD
  NONPROFIT
  GOVERNMENT
  OTHER
}

enum RelationshipEnum {
  COLD
  WARM
  ESTABLISHED
  DORMANT
}

enum SequenceStatus {
  DRAFT
  ACTIVE
  PAUSED
  COMPLETED
}

enum TravelDistance {
  LOCAL
  REGIONAL
  DOMESTIC
  INTERNATIONAL
  NO_LIMIT
}

enum TypeOfPersonEnum {
  CURRENT_CLIENT
  FORMER_CLIENT
  FORMER_COWORKER
  PROSPECT
  PARTNER
  FRIEND_OF_FRIEND
}

enum WorkCollateralStatus {
  NOT_STARTED
  IN_PROGRESS
  IN_REVIEW
  CHANGES_NEEDED
  CHANGES_IN_PROGRESS
  APPROVED
}

enum WorkItemStatus {
  TODO
  IN_PROGRESS
  COMPLETED
}

enum WorkItemType {
  BLOG
  PERSONA
  OUTREACH_TEMPLATE
  EVENT_CLE_PLAN
  PRESENTATION_DECK
  LANDING_PAGE
}

enum WorkPackageItemStatus {
  NOT_STARTED
  IN_PROGRESS
  IN_REVIEW
  CHANGES_NEEDED
  CHANGES_IN_PROGRESS
  APPROVED
}

enum InvoiceStatus {
  NOT_PAID
  PAID
  PARTIAL
}

enum InvoiceType {
  PLATFORM_FEE
  MONTHLY_RECURRING
  CUSTOM
  WORK_PACKAGE
  PLAN_SUBSCRIPTION
}

enum PlanInterval {
  MONTH
  YEAR
}

enum PlatformAccessStatus {
  ACTIVE
  PAST_DUE
  CANCELED
}

enum WorkPackageStatus {
  ACTIVE
  COMPLETED
}

// Financials - Simple ledger system
model financials {
  id          String   @id @default(cuid())
  companyHQId String   @unique
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  company_hqs company_hqs   @relation(fields: [companyHQId], references: [id], onDelete: Cascade)
  expenses    expenses[]
  income      income[]
  equity      equity[]
  csvImports  csv_imports[]

  @@map("financials")
}

model expenses {
  id           String   @id @default(cuid())
  financialsId String
  date         DateTime
  amount       Int // Amount in cents
  description  String
  category     String? // Free-form category name
  vendor       String?
  receiptUrl   String?

  // CSV import tracking
  csvImportId  String?
  csvRowNumber Int?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  financials  financials   @relation(fields: [financialsId], references: [id], onDelete: Cascade)
  csv_imports csv_imports? @relation(fields: [csvImportId], references: [id])

  @@index([financialsId])
  @@index([date])
  @@index([category])
  @@map("expenses")
}

model income {
  id           String   @id @default(cuid())
  financialsId String
  date         DateTime
  amount       Int // Amount in cents
  description  String
  category     String? // Free-form category name
  source       String?

  // Stripe integration
  stripePaymentIntentId String? @unique
  stripeInvoiceId       String?
  invoiceId             String? // FK to invoices

  // CSV import tracking
  csvImportId  String?
  csvRowNumber Int?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  financials    financials   @relation(fields: [financialsId], references: [id], onDelete: Cascade)
  invoices      invoices?    @relation(fields: [invoiceId], references: [id])
  csv_imports   csv_imports? @relation(fields: [csvImportId], references: [id])
  companyHqs    company_hqs? @relation(fields: [company_hqsId], references: [id])
  company_hqsId String?

  @@index([financialsId])
  @@index([date])
  @@index([category])
  @@index([stripePaymentIntentId])
  @@map("income")
}

model equity {
  id           String   @id @default(cuid())
  financialsId String
  date         DateTime
  amount       Int // Amount in cents
  description  String
  category     String? // Free-form category name
  source       String?

  // CSV import tracking
  csvImportId  String?
  csvRowNumber Int?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  financials  financials   @relation(fields: [financialsId], references: [id], onDelete: Cascade)
  csv_imports csv_imports? @relation(fields: [csvImportId], references: [id])

  @@index([financialsId])
  @@index([date])
  @@index([category])
  @@map("equity")
}

model csv_imports {
  id            String       @id @default(cuid())
  financialsId  String
  fileName      String
  fileUrl       String
  rowCount      Int
  importedCount Int          @default(0)
  status        ImportStatus @default(PENDING)
  columnMapping Json? // Column mapping config
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt

  financials financials @relation(fields: [financialsId], references: [id], onDelete: Cascade)
  expenses   expenses[]
  income     income[]
  equity     equity[]

  @@index([financialsId])
  @@map("csv_imports")
}

enum ImportStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}

enum PersonaType {
  DECISION_MAKER
  INFLUENCER
  END_USER
  GATEKEEPER
  CHAMPION
  OTHER
}

enum EmailSource {
  PLATFORM
  OFF_PLATFORM
}

model emails {
  id        String      @id @default(cuid())
  contactId String // FK to Contact
  sendDate  DateTime // When email was sent
  subject   String?
  body      String?     @db.Text // Full email body
  source    EmailSource // PLATFORM | OFF_PLATFORM
  platform  String? // "sendgrid", "gmail", "outlook", "apollo", "manual"

  // Response tracking
  contactResponse String?   @db.Text // The actual reply text from contact
  respondedAt     DateTime? // When contact responded
  responseSubject String? // Subject of their reply
  hasResponded    Boolean   @default(false)

  // References to original records (if applicable)
  emailActivityId   String? @unique // If from email_activities
  offPlatformSendId String? @unique // If from off_platform_email_sends

  // Metadata
  messageId  String? @unique // SendGrid message ID (if platform)
  campaignId String?
  sequenceId String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  contacts           Contact                   @relation(fields: [contactId], references: [id], onDelete: Cascade)
  email_activities   email_activities?         @relation("EmailActivityToEmail", fields: [emailActivityId], references: [id], onDelete: SetNull)
  off_platform_sends off_platform_email_sends? @relation("OffPlatformSendToEmail", fields: [offPlatformSendId], references: [id], onDelete: SetNull)
  campaigns          campaigns?                @relation(fields: [campaignId], references: [id], onDelete: SetNull)

  @@index([contactId])
  @@index([contactId, sendDate])
  @@index([sendDate])
  @@index([hasResponded])
  @@index([source])
  @@index([messageId])
  @@map("emails")
}

enum ContextOfRelationship {
  DONT_KNOW
  PRIOR_CONVERSATION
  PRIOR_COLLEAGUE
  PRIOR_SCHOOLMATE
  CURRENT_CLIENT
  CONNECTED_LINKEDIN_ONLY
  REFERRAL
  REFERRAL_FROM_WARM_CONTACT
  USED_TO_WORK_AT_TARGET_COMPANY
}

enum RelationshipRecency {
  NEW
  RECENT
  STALE
  LONG_DORMANT
}

enum CompanyAwareness {
  NO_CLUE
  KNOWS_COMPANY
  KNOWS_COMPANY_COMPETITOR
  KNOWS_BUT_DISENGAGED
}

// Where in the email template this snippet belongs (not "type" like email â€” position in the template)
enum TemplatePosition {
  SUBJECT_LINE
  OPENING_GREETING
  CATCH_UP
  BUSINESS_CONTEXT
  VALUE_PROPOSITION
  COMPETITOR_FRAME
  TARGET_ASK
  SOFT_CLOSE
}

model off_platform_email_sends {
  id        String   @id @default(cuid())
  contactId String
  emailSent DateTime // When the email was actually sent (off-platform)
  subject   String? // Optional: what was the subject?
  platform  String? // Optional: "gmail", "outlook", "apollo", "manual", etc.
  notes     String? // Optional: any notes about the send
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  contacts Contact @relation(fields: [contactId], references: [id], onDelete: Cascade)
  emails   emails? @relation("OffPlatformSendToEmail")

  @@index([contactId])
  @@index([contactId, emailSent])
  @@index([emailSent])
  @@map("off_platform_email_sends")
}
