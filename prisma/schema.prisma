generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_DATABASE_URL")
}

model platform {
  id           String         @id @default(uuid())
  name         String
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  company_hqs  company_hqs[]
  super_admins super_admins[]
}

model assessments {
  id                   String       @id
  ownerId              String
  companyHQId          String?
  name                 String
  company              String
  industry             String?
  workTooMuch          String?
  assignTasks          String?
  wantMoreClients      String?
  revenueGrowthPercent Float?
  totalVolume          Float?
  bdSpend              Float?
  score                Int?
  scoreInterpretation  String?
  relateWithUser       String?
  growthNeeds          String?
  rawGptResponse       String?
  createdAt            DateTime     @default(now())
  updatedAt            DateTime
  company_hqs          company_hqs? @relation(fields: [companyHQId], references: [id])
  owners               owners       @relation(fields: [ownerId], references: [id], onDelete: Cascade)

  @@index([companyHQId])
  @@index([ownerId])
}

model bd_eventop_intel {
  id               String         @id
  companyHQId      String
  ownerId          String
  eventMetaId      String
  personaId        String?
  personaAlignment Int?
  travelBurden     Int?
  costFit          Int?
  ecosystemFit     Int?
  bdOpportunity    Int?
  notes            String?
  status           EventOppStatus @default(CONSIDERING)
  createdAt        DateTime       @default(now())
  updatedAt        DateTime
  event_metas      event_metas    @relation(fields: [eventMetaId], references: [id])

  @@index([companyHQId])
  @@index([eventMetaId])
  @@index([ownerId])
  @@index([personaId])
  @@index([status])
  @@map("bd_eventop_intel")
}

model bd_intels {
  id                    String   @id
  personaId             String   @unique
  fitScore              Int
  painAlignmentScore    Int
  workflowFitScore      Int
  urgencyScore          Int
  adoptionBarrierScore  Int
  risks                 Json?
  opportunities         Json?
  recommendedTalkTrack  String?
  recommendedSequence   String?
  recommendedLeadSource String?
  finalSummary          String?
  createdAt             DateTime @default(now())
  updatedAt             DateTime
  personas              personas @relation(fields: [personaId], references: [id], onDelete: Cascade)
}

model bdos_scores {
  id               String   @id
  contactId        String
  productId        String
  personaId        String?
  totalScore       Int
  personaFit       Int
  productFit       Int
  companyReadiness Int
  buyingPower      Int
  seniority        Int
  urgency          Int
  rationale        String?
  rawResponse      Json?
  createdAt        DateTime @default(now())

  @@index([contactId])
  @@index([createdAt])
  @@index([personaId])
  @@index([productId])
}

model blogs {
  id           String      @id
  companyHQId  String
  title        String
  createdAt    DateTime    @default(now())
  updatedAt    DateTime
  blogText     String?
  description  String?
  presenter    String?
  sections     Json?
  subtitle     String?
  googleDocUrl String?
  company_hqs  company_hqs @relation(fields: [companyHQId], references: [id], onDelete: Cascade)

  @@index([companyHQId])
}

model client_uploads {
  id           String   @id
  ownerId      String
  fileUrl      String
  originalName String
  fileType     String?
  size         Int?
  status       String   @default("stored")
  createdAt    DateTime @default(now())

  @@index([ownerId])
}

model companies {
  id                    String          @id
  companyHQId           String
  companyName           String
  address               String?
  industry              String?
  website               String?
  revenue               Float?
  yearsInBusiness       Int?
  proposalId            String?
  contractId            String?
  invoiceId             String?
  createdAt             DateTime        @default(now())
  updatedAt             DateTime
  category              String?
  companyHealthScore    Int?
  competitors           String[]        @default([])
  domain                String?         @unique
  fundingStage          String?
  growthRate            Float?
  growthScore           Int?
  headcount             Int?
  headcountTier         String?
  lastFundingAmount     Float?
  lastFundingDate       DateTime?
  marketPositionScore   Int?
  normalizedIndustry    String?
  numberOfFundingRounds Int?
  positioningLabel      String?
  readinessScore        Int?
  revenueRange          String?
  revenueTier           String?
  stabilityScore        Int?
  company_hqs           company_hqs     @relation(fields: [companyHQId], references: [id], onDelete: Cascade)
  contacts              Contact[]
  proposals             proposals[]
  work_packages         work_packages[]

  @@index([domain])
}

model company_hqs {
  id                                            String                          @id
  companyName                                   String
  companyStreet                                 String?
  companyCity                                   String?
  companyState                                  String?
  companyWebsite                                String?
  whatYouDo                                     String?
  companyIndustry                               String?
  teamSize                                      String?
  createdAt                                     DateTime                        @default(now())
  updatedAt                                     DateTime
  ownerId                                       String?
  contactOwnerId                                String?
  managerId                                     String?
  companyAnnualRev                              String?
  yearsInBusiness                               String?
  platformId                                    String?
  tier                                          String? // Product tier for future use (not gated)
  assessments                                   assessments[]
  blogs                                         blogs[]
  companies                                     companies[]
  contacts_company_hqs_contactOwnerIdTocontacts Contact?                        @relation("company_hqs_contactOwnerIdTocontacts", fields: [contactOwnerId], references: [id])
  owners_company_hqs_managerIdToowners          owners?                         @relation("company_hqs_managerIdToowners", fields: [managerId], references: [id])
  owners_company_hqs_ownerIdToowners            owners?                         @relation("company_hqs_ownerIdToowners", fields: [ownerId], references: [id])
  company_memberships                           company_memberships[]
  consultant_deliverables                       consultant_deliverables[]
  contact_lists                                 contact_lists[]
  contacts_contacts_crmIdTocompany_hqs          Contact[]                       @relation("contacts_crmIdTocompany_hqs")
  ownedWorkPackages                             work_packages[]                 @relation("WorkPackageOwner")
  deliverable_templates                         deliverable_templates[]
  domain_registry                               domain_registry?
  landing_pages                                 landing_pages[]
  personas                                      personas[]
  phase_templates                               phase_templates[]
  presentations                                 Presentation[]
  products                                      products[]
  proposals                                     proposals[]
  templates                                     Template[]
  template_relationship_helpers                 template_relationship_helpers[]
  campaigns                                     campaigns[]
  email_sequences                               email_sequences[]
  platform                                      platform?                       @relation(fields: [platformId], references: [id])

  @@index([platformId])
}

model company_memberships {
  id          String      @id
  userId      String // owner.id (not firebaseId)
  companyHqId String
  role        String
  createdAt   DateTime    @default(now())
  owners      owners      @relation(fields: [userId], references: [id], onDelete: Cascade)
  company_hqs company_hqs @relation(fields: [companyHqId], references: [id], onDelete: Cascade)

  @@unique([userId, companyHqId])
  @@index([companyHqId])
  @@index([userId, companyHqId])
  @@index([userId])
}

model consultant_deliverables {
  id               String      @id
  contactId        String
  title            String
  description      String?
  category         String?
  type             String?
  workContent      Json?
  status           String      @default("pending")
  proposalId       String?
  milestoneId      String?
  dueDate          DateTime?
  completedAt      DateTime?
  notes            String?
  companyHQId      String
  contactCompanyId String?
  createdAt        DateTime    @default(now())
  updatedAt        DateTime
  company_hqs      company_hqs @relation(fields: [companyHQId], references: [id], onDelete: Cascade)
  contacts         Contact     @relation(fields: [contactId], references: [id], onDelete: Cascade)
  proposals        proposals?  @relation(fields: [proposalId], references: [id])

  @@index([companyHQId])
  @@index([contactId])
  @@index([proposalId])
}

model contact_lists {
  id            String      @id
  companyId     String
  name          String
  description   String?
  type          String      @default("static") // static, smart, manual
  filters       Json? // For smart lists: { audienceType: "...", stages: [...], tags: [...] }
  totalContacts Int         @default(0)
  lastUpdated   DateTime    @default(now())
  isActive      Boolean     @default(true)
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  company_hqs   company_hqs @relation(fields: [companyId], references: [id], onDelete: Cascade)
  contacts      Contact[]
  campaigns     campaigns[]

  @@unique([companyId, name])
  @@index([companyId])
  @@index([isActive])
}

model Contact {
  id                                               String                    @id @default(uuid())
  crmId                                            String
  firstName                                        String?
  lastName                                         String?
  fullName                                         String?
  goesBy                                           String?
  email                                            String?                   @unique
  phone                                            String?
  title                                            String?
  seniority                                        String?
  department                                       String?
  linkedinUrl                                      String?
  city                                             String?
  state                                            String?
  country                                          String?
  companyName                                      String?
  companyDomain                                    String?
  contactCompanyId                                 String?
  buyerPerson                                      BuyerPerson?
  buyingReadiness                                  BuyingReadiness?
  howMet                                           String?
  notes                                            String?
  contactListId                                    String?
  domain                                           String?
  enrichmentSource                                 String?
  enrichmentFetchedAt                              DateTime?
  enrichmentPayload                                Json?
  createdById                                      String?
  firebaseUid                                      String?                   @unique
  clientPortalUrl                                  String?                   @default("https://clientportal.ignitegrowth.biz")
  isActivated                                      Boolean                   @default(false)
  activatedAt                                      DateTime?
  ownerId                                          String?
  role                                             String                    @default("contact")
  createdAt                                        DateTime                  @default(now())
  updatedAt                                        DateTime
  averageTenureMonths                              Float?
  avgTenureYears                                   Float?
  budgetAuthority                                  Boolean?
  buyerLikelihoodScore                             Int?
  buyingPowerScore                                 Int?
  buyingTriggers                                   String[]                  @default([])
  careerMomentumScore                              Int?
  careerProgression                                String?
  careerStabilityScore                             Int?
  careerTimeline                                   Json?
  companyId                                        String?
  companyIndustry                                  String?
  companySize                                      String?
  currentRoleStartDate                             DateTime?
  currentTenureYears                               Float?
  decisionMaker                                    Boolean?
  enrichmentRedisKey                               String?
  gatekeeper                                       Boolean?
  goals                                            String[]                  @default([])
  influencer                                       Boolean?
  jobRole                                          String?
  numberOfJobChanges                               Int?
  painPoints                                       String[]                  @default([])
  profileSummary                                   String?
  readinessToBuyScore                              Int?
  recentJobChange                                  Boolean?
  recentPromotion                                  Boolean?
  rolePowerScore                                   Int?
  seniorityScore                                   Int?
  tenureYears                                      Int?
  timezone                                         String?
  totalExperienceYears                             Float?
  totalYearsExperience                             Float?
  urgencyScore                                     Int?
  company_hqs_company_hqs_contactOwnerIdTocontacts company_hqs[]             @relation("company_hqs_contactOwnerIdTocontacts")
  consultant_deliverables                          consultant_deliverables[]
  companies                                        companies?                @relation(fields: [contactCompanyId], references: [id])
  contact_lists                                    contact_lists?            @relation(fields: [contactListId], references: [id])
  company_hqs_contacts_crmIdTocompany_hqs          company_hqs               @relation("contacts_crmIdTocompany_hqs", fields: [crmId], references: [id])
  invite_tokens                                    invite_tokens[]
  pipelines                                        pipelines?
  proposals                                        proposals[]
  workPackagesAsClient                             work_packages[]           @relation("WorkPackageClient")
  workPackagesAsMember                             work_packages[]           @relation("WorkPackageMember")

  @@index([companyDomain])
  @@index([companyId])
  @@index([domain])
  @@index([email])
  @@index([firebaseUid])
  @@index([ownerId])
  @@index([role])
  @@map("contacts")
}

model deliverable_templates {
  id                          String                        @id
  companyHQId                 String
  deliverableType             String
  deliverableLabel            String
  defaultUnitOfMeasure        String
  defaultDuration             Int
  createdAt                   DateTime                      @default(now())
  company_hqs                 company_hqs                   @relation(fields: [companyHQId], references: [id], onDelete: Cascade)
  phase_deliverable_templates phase_deliverable_templates[]

  @@unique([companyHQId, deliverableType])
  @@index([companyHQId])
}

model domain_registry {
  id              String      @id
  domain          String      @unique
  normalizedName  String?
  companyHqId     String      @unique
  firstSeen       DateTime    @default(now())
  lastSeen        DateTime
  confidenceScore Float?      @default(1.0)
  company_hqs     company_hqs @relation(fields: [companyHqId], references: [id], onDelete: Cascade)

  @@index([companyHqId])
  @@index([domain])
}

model ecosystem_orgs {
  id                          String                @id
  name                        String
  website                     String?
  city                        String?
  state                       String?
  archetype                   OrganizationArchetype
  whatTheyDo                  String?
  annualRevenue               Int?
  duesInfo                    String?
  memberCount                 Int?
  memberDescription           String?
  memberSeniority             String?
  memberIndustries            String[]
  memberReasonForAffiliation  String?
  memberAffiliationStrength   String?
  orgRelevanceToCompanyHQ     String?
  bdCompanyHQAffiliationScore Int?
  targetPersonaAlignment      Int?
  createdAt                   DateTime              @default(now())

  @@index([archetype])
  @@index([name])
}

model email_activities {
  id                  String           @id @default(uuid())
  owner_id            String
  contact_id          String?
  tenant_id           String?
  campaign_id         String?
  sequence_id         String?
  sequence_step_id    String?
  email               String
  subject             String
  body                String
  event               String? // Latest event: sent, delivered, opened, clicked, replied, bounce, etc.
  messageId           String           @unique
  reply_to_message_id String? // If this is a reply, link to original email
  createdAt           DateTime         @default(now())
  updatedAt           DateTime
  owners              owners           @relation(fields: [owner_id], references: [id], onDelete: Cascade)
  campaigns           campaigns?       @relation(fields: [campaign_id], references: [id], onDelete: SetNull)
  email_sequences     email_sequences? @relation(fields: [sequence_id], references: [id], onDelete: SetNull)
  sequence_steps      sequence_steps?  @relation(fields: [sequence_step_id], references: [id], onDelete: SetNull)

  @@index([contact_id])
  @@index([messageId])
  @@index([owner_id])
  @@index([campaign_id])
  @@index([sequence_id])
  @@index([contact_id, createdAt])
}

// Campaigns - Apollo-like campaign management
model campaigns {
  id               String             @id @default(uuid())
  owner_id         String
  company_hq_id    String?
  name             String
  description      String?
  status           CampaignStatus     @default(DRAFT) // DRAFT, SCHEDULED, ACTIVE, PAUSED, COMPLETED, CANCELLED
  type             CampaignType       @default(EMAIL) // EMAIL, SEQUENCE, ONE_OFF
  // WHO - Contact list (reusable, modular)
  contact_list_id  String?
  contact_lists    contact_lists?     @relation(fields: [contact_list_id], references: [id], onDelete: SetNull)
  // WHAT - Email template (optional - can be manual or from template)
  template_id      String?
  template         Template?         @relation(fields: [template_id], references: [id], onDelete: SetNull)
  // Email content (optional - can be in sequences or from template)
  subject          String?
  preview_text     String?
  body             String? // Email body content
  from_email       String?
  from_name        String?
  // Signature (optional - reusable signature) - TODO: Re-enable after email_signatures model is added
  // signature_id     String?
  // email_signatures email_signatures?  @relation("campaign_signatures", fields: [signature_id], references: [id], onDelete: SetNull)
  scheduled_for    DateTime?
  started_at       DateTime?
  completed_at     DateTime?
  total_recipients Int                @default(0)
  emails_sent      Int                @default(0)
  emails_delivered Int                @default(0)
  emails_opened    Int                @default(0)
  emails_clicked   Int                @default(0)
  emails_replied   Int                @default(0)
  emails_bounced   Int                @default(0)
  open_rate        Float?
  click_rate       Float?
  reply_rate       Float?
  bounce_rate      Float?
  created_at       DateTime           @default(now())
  updated_at       DateTime           @updatedAt
  owners           owners             @relation(fields: [owner_id], references: [id], onDelete: Cascade)
  company_hqs      company_hqs?       @relation(fields: [company_hq_id], references: [id], onDelete: Cascade)
  email_activities email_activities[]
  email_sequences  email_sequences[]

  @@index([owner_id])
  @@index([company_hq_id])
  @@index([status])
  @@index([created_at])
  @@index([contact_list_id])
  @@index([template_id])
  // @@index([signature_id]) // TODO: Re-enable after email_signatures model is added
}

enum CampaignStatus {
  DRAFT
  SCHEDULED
  ACTIVE
  PAUSED
  COMPLETED
  CANCELLED
}

enum CampaignType {
  EMAIL
  SEQUENCE
  ONE_OFF
}

// Email Sequences - Multi-step email flows (Apollo-like)
model email_sequences {
  id                  String             @id @default(uuid())
  campaign_id         String?
  owner_id            String
  company_hq_id       String?
  name                String
  description         String?
  status              SequenceStatus     @default(DRAFT) // DRAFT, ACTIVE, PAUSED, COMPLETED
  auto_pause_on_reply Boolean            @default(true)
  total_recipients    Int                @default(0)
  emails_sent         Int                @default(0)
  emails_opened       Int                @default(0)
  emails_clicked      Int                @default(0)
  emails_replied      Int                @default(0)
  open_rate           Float?
  click_rate          Float?
  reply_rate          Float?
  created_at          DateTime           @default(now())
  updated_at          DateTime           @updatedAt
  campaigns           campaigns?         @relation(fields: [campaign_id], references: [id], onDelete: SetNull)
  owners              owners             @relation(fields: [owner_id], references: [id], onDelete: Cascade)
  company_hqs         company_hqs?       @relation(fields: [company_hq_id], references: [id], onDelete: Cascade)
  sequence_steps      sequence_steps[]
  email_activities    email_activities[]

  @@index([owner_id])
  @@index([campaign_id])
  @@index([status])
}

enum SequenceStatus {
  DRAFT
  ACTIVE
  PAUSED
  COMPLETED
}

// Sequence Steps - Individual emails in a sequence
model sequence_steps {
  id               String             @id @default(uuid())
  sequence_id      String
  step_number      Int // Order in sequence (1, 2, 3, ...)
  name             String?
  subject          String
  body             String
  delay_days       Int                @default(0) // Days to wait before sending this step
  delay_hours      Int                @default(0) // Additional hours
  conditions       Json? // Conditional logic: { if_opened: true, if_clicked: false, if_replied: false }
  from_email       String?
  from_name        String?
  // Signature (optional - reusable signature) - TODO: Re-enable after email_signatures model is added
  // signature_id     String? // Optional signature for this step
  // email_signatures email_signatures?  @relation("sequence_step_signatures", fields: [signature_id], references: [id], onDelete: SetNull)
  total_sent       Int                @default(0)
  total_opened     Int                @default(0)
  total_clicked    Int                @default(0)
  total_replied    Int                @default(0)
  open_rate        Float?
  click_rate       Float?
  reply_rate       Float?
  created_at       DateTime           @default(now())
  updated_at       DateTime           @updatedAt
  email_sequences  email_sequences    @relation(fields: [sequence_id], references: [id], onDelete: Cascade)
  email_activities email_activities[]

  @@unique([sequence_id, step_number])
  @@index([sequence_id])
  @@index([sequence_id, step_number])
  // @@index([signature_id]) // TODO: Re-enable after email_signatures model is added
}

// Email Events - REMOVED for MVP1 (deprecated - using email_activities.event instead)
// Migration will drop this table - keeping enum commented for reference
// enum EmailEventType {
//   SENT
//   DELIVERED
//   OPEN
//   CLICK
//   REPLY
//   BOUNCE
//   DROP
//   DEFERRED
//   UNSUBSCRIBE
//   SPAM_REPORT
// }

model event_metas {
  id               String             @id
  name             String
  seriesName       String?
  eventType        EventType
  organizerId      String?
  city             String?
  state            String?
  country          String?
  startDate        DateTime?
  endDate          DateTime?
  dateRange        String?
  costMin          Int?
  costMax          Int?
  currency         String?
  sourceType       EventSourceType    @default(AI)
  rawJson          Json?
  createdAt        DateTime           @default(now())
  bd_eventop_intel bd_eventop_intel[]

  @@index([eventType])
  @@index([name])
  @@index([organizerId])
}

model bd_event_ops {
  id              String            @id @default(uuid())
  companyHQId     String
  ownerId         String
  eventPlanId     String?
  eventTunerId    String?
  title           String
  description     String?
  whyGo           String?
  eventType       EventType
  startDate       DateTime?
  endDate         DateTime?
  city            String?
  state           String?
  country         String?
  costBand        String?
  source          EventSource       @default(MANUAL)
  prioritySource  String? // "BD_INTEL" if from BD intelligence
  status          EventOppStatus    @default(CONSIDERING)
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  event_plan_opps event_plan_opps[]
  event_tuners    event_tuners?     @relation(fields: [eventTunerId], references: [id], onDelete: SetNull)

  @@index([companyHQId])
  @@index([ownerId])
  @@index([eventPlanId])
  @@index([eventTunerId])
  @@index([status])
  @@index([source])
  @@index([prioritySource])
}

enum EventSource {
  PERSONA
  USER_PREF
  MANUAL
  BD_INTEL
}

enum EventCostRange {
  FREE
  LOW_0_500
  MEDIUM_500_2000
  HIGH_2000_5000
  PREMIUM_5000_PLUS
  NO_LIMIT
}

enum TravelDistance {
  LOCAL
  REGIONAL
  DOMESTIC
  INTERNATIONAL
  NO_LIMIT
}

model event_tuners {
  id                    String                 @id @default(uuid())
  companyHQId           String
  ownerId               String
  name                  String
  conferencesPerQuarter Int?
  costRange             EventCostRange?
  eventSearchRawText    String?
  travelDistance        TravelDistance?
  isActive              Boolean                @default(true)
  createdAt             DateTime               @default(now())
  updatedAt             DateTime               @updatedAt
  preferredStates       event_tuner_states[]
  event_tuner_personas  event_tuner_personas[]
  bd_event_ops          bd_event_ops[]

  @@index([companyHQId])
  @@index([ownerId])
  @@index([isActive])
}

model event_tuner_states {
  id           String       @id @default(uuid())
  eventTunerId String
  state        String
  createdAt    DateTime     @default(now())
  event_tuners event_tuners @relation(fields: [eventTunerId], references: [id], onDelete: Cascade)

  @@unique([eventTunerId, state])
  @@index([eventTunerId])
  @@index([state])
}

model event_tuner_personas {
  id           String       @id @default(uuid())
  eventTunerId String
  personaId    String
  createdAt    DateTime     @default(now())
  event_tuners event_tuners @relation(fields: [eventTunerId], references: [id], onDelete: Cascade)
  personas     personas     @relation(fields: [personaId], references: [id], onDelete: Cascade)

  @@unique([eventTunerId, personaId])
  @@index([eventTunerId])
  @@index([personaId])
}

model event_plan_opps {
  id           String        @id
  eventPlanId  String
  bdEventOppId String
  order        Int?
  createdAt    DateTime      @default(now())
  bd_event_ops bd_event_ops? @relation(fields: [bdEventOppId], references: [id], onDelete: Cascade)

  @@unique([eventPlanId, bdEventOppId])
  @@index([bdEventOppId])
  @@index([eventPlanId])
}

model event_plans {
  id           String   @id
  companyHQId  String
  description  String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime
  name         String
  ownerId      String
  presenter    String?
  spacingScore Int?
  totalCost    Int?
  totalTrips   Int?
  year         Int?

  @@index([companyHQId])
  @@index([ownerId])
}

model invite_tokens {
  id        String   @id
  contactId String
  email     String
  token     String   @unique
  expiresAt DateTime
  used      Boolean  @default(false)
  createdAt DateTime @default(now())
  contacts  Contact  @relation(fields: [contactId], references: [id], onDelete: Cascade)

  @@index([contactId])
  @@index([email])
  @@index([token])
}

model invoice_milestones {
  id             String     @id
  invoiceId      String
  label          String
  expectedAmount Int
  expectedDate   DateTime?
  description    String?
  status         String     @default("pending")
  createdAt      DateTime   @default(now())
  updatedAt      DateTime
  invoices       invoices   @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  payments       payments[]

  @@index([invoiceId])
  @@index([status])
}

model invoice_template_milestones {
  id                String            @id
  templateId        String
  label             String
  expectedAmount    Float
  expectedDate      DateTime?
  description       String?
  createdAt         DateTime          @default(now())
  updatedAt         DateTime
  invoice_templates invoice_templates @relation(fields: [templateId], references: [id], onDelete: Cascade)

  @@index([templateId])
}

model invoice_templates {
  id                          String                        @id
  name                        String
  notes                       String?
  createdAt                   DateTime                      @default(now())
  updatedAt                   DateTime
  invoice_template_milestones invoice_template_milestones[]
}

model invoices {
  id                      String               @id
  workPackageId           String
  invoiceName             String
  invoiceDescription      String?
  totalExpected           Int                  @default(0)
  totalReceived           Int                  @default(0)
  status                  String               @default("pending")
  createdAt               DateTime             @default(now())
  updatedAt               DateTime
  invoiceNumber           String?
  amount                  Float?
  currency                String               @default("USD")
  paidAt                  DateTime?
  paidByContactId         String?
  stripeCheckoutSessionId String?
  stripePaymentIntentId   String?
  stripeCustomerId        String?
  invoice_milestones      invoice_milestones[]
  work_packages           work_packages        @relation(fields: [workPackageId], references: [id], onDelete: Cascade)
  payments                payments[]

  @@index([status])
  @@index([stripeCustomerId])
  @@index([workPackageId])
}

model landing_pages {
  id          String      @id
  companyHQId String
  title       String
  url         String?
  content     Json?
  description String?
  published   Boolean     @default(false)
  publishedAt DateTime?
  createdAt   DateTime    @default(now())
  updatedAt   DateTime
  presenter   String?
  company_hqs company_hqs @relation(fields: [companyHQId], references: [id], onDelete: Cascade)

  @@index([companyHQId])
  @@index([published])
}

model owners {
  id                                        String                @id
  firebaseId                                String                @unique
  firstName                                 String?
  lastName                                  String?
  name                                      String? // Deprecated: Use firstName and lastName instead
  email                                     String?
  photoURL                                  String?
  teamSize                                  String?
  tier                                      String?               @default("foundation") // Product tier: foundation, growth, scale
  microsoftAccessToken                      String?
  microsoftRefreshToken                     String?
  microsoftExpiresAt                        DateTime?
  microsoftEmail                            String?
  microsoftDisplayName                      String?
  microsoftTenantId                         String?
  sendgridVerifiedEmail                     String? // Verified sender email for SendGrid
  sendgridVerifiedName                      String? // Display name for verified sender
  createdAt                                 DateTime              @default(now())
  updatedAt                                 DateTime
  assessments                               assessments[]
  company_hqs_company_hqs_managerIdToowners company_hqs[]         @relation("company_hqs_managerIdToowners")
  company_hqs_company_hqs_ownerIdToowners   company_hqs[]         @relation("company_hqs_ownerIdToowners")
  company_memberships                       company_memberships[]
  email_activities                          email_activities[]
  campaigns                                 campaigns[]
  email_sequences                           email_sequences[]
  super_admins                              super_admins?
  google_oauth_tokens                       GoogleOAuthToken[]
  templates                                 Template[]            // Templates created by this owner
  // email_signatures email_signatures[]    // Email signatures created by this owner - TODO: Re-enable after model is added
}

model payments {
  id                    String              @id
  invoiceId             String
  milestoneId           String?
  amountReceived        Int
  currency              String              @default("USD")
  paidAt                DateTime
  stripeSessionId       String?             @unique
  stripePaymentIntentId String?             @unique
  paidByContactId       String?
  createdAt             DateTime            @default(now())
  invoices              invoices            @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  invoice_milestones    invoice_milestones? @relation(fields: [milestoneId], references: [id])

  @@index([invoiceId])
  @@index([milestoneId])
  @@index([stripePaymentIntentId])
  @@index([stripeSessionId])
}

model personas {
  id                   String                 @id
  companyHQId          String
  personName           String                 @default("")
  title                String
  headline             String?
  seniority            String?
  industry             String?
  subIndustries        String[]
  company              String?
  companySize          String?
  annualRevenue        String?
  location             String?
  description          String?
  whatTheyWant         String?
  painPoints           String[]
  risks                String[]
  decisionDrivers      String[]
  buyerTriggers        String[]
  createdAt            DateTime               @default(now())
  updatedAt            DateTime
  productId            String?
  bd_intels            bd_intels?
  company_hqs          company_hqs            @relation(fields: [companyHQId], references: [id], onDelete: Cascade)
  products             products?              @relation(fields: [productId], references: [id])
  product_fits         product_fits?
  event_tuner_personas event_tuner_personas[]
}

model phase_deliverable_templates {
  id                    String                @id
  phaseTemplateId       String
  deliverableTemplateId String
  defaultQuantity       Int?                  @default(1)
  order                 Int?                  @default(0)
  createdAt             DateTime              @default(now())
  deliverable_templates deliverable_templates @relation(fields: [deliverableTemplateId], references: [id], onDelete: Cascade)
  phase_templates       phase_templates       @relation(fields: [phaseTemplateId], references: [id], onDelete: Cascade)

  @@unique([phaseTemplateId, deliverableTemplateId])
}

model phase_templates {
  id                          String                        @id
  companyHQId                 String
  name                        String
  description                 String?
  createdAt                   DateTime                      @default(now())
  phase_deliverable_templates phase_deliverable_templates[]
  company_hqs                 company_hqs                   @relation(fields: [companyHQId], references: [id], onDelete: Cascade)
  proposal_phases             proposal_phases[]

  @@unique([companyHQId, name])
  @@index([companyHQId])
}

model pipelines {
  id        String   @id
  contactId String   @unique
  pipeline  String
  stage     String
  createdAt DateTime @default(now())
  updatedAt DateTime
  contacts  Contact  @relation(fields: [contactId], references: [id], onDelete: Cascade)
}

model Presentation {
  id                String      @id
  companyHQId       String
  title             String
  description       String?
  slides            Json?
  published         Boolean     @default(false)
  publishedAt       DateTime?
  createdAt         DateTime    @default(now())
  updatedAt         DateTime
  feedback          Json?
  gammaBlob         String?
  gammaDeckUrl      String?
  gammaError        String?
  gammaPptxUrl      String?
  gammaStatus       String?
  presenter         String?
  gammaGenerationId String?
  companyHQ         company_hqs @relation(fields: [companyHQId], references: [id], onDelete: Cascade)

  @@index([companyHQId])
  @@index([published])
  @@map("presentations")
}

model product_fits {
  id                 String   @id
  personaId          String   @unique
  productId          String
  valuePropToThem    String
  alignmentReasoning String
  createdAt          DateTime @default(now())
  updatedAt          DateTime
  personas           personas @relation(fields: [personaId], references: [id], onDelete: Cascade)
  products           products @relation(fields: [productId], references: [id], onDelete: Cascade)
}

model products {
  id                    String         @id
  companyHQId           String
  name                  String
  description           String?
  valueProp             String?
  price                 Float?
  priceCurrency         String?        @default("USD")
  pricingModel          String?
  category              String?
  deliveryTimeline      String?
  targetMarketSize      String?
  salesCycleLength      String?
  features              String?
  competitiveAdvantages String?
  targetedTo            String?
  createdAt             DateTime       @default(now())
  updatedAt             DateTime
  personas              personas[]
  product_fits          product_fits[]
  company_hqs           company_hqs    @relation(fields: [companyHQId], references: [id], onDelete: Cascade)
}

model proposal_deliverables {
  id          String    @id
  proposalId  String
  name        String
  description String?
  quantity    Int       @default(1)
  unitPrice   Float?
  totalPrice  Float?
  notes       String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime
  proposals   proposals @relation(fields: [proposalId], references: [id], onDelete: Cascade)

  @@index([proposalId])
}

model proposal_phases {
  id              String           @id
  proposalId      String
  phaseTemplateId String?
  name            String
  description     String?
  durationWeeks   Int
  order           Int
  createdAt       DateTime         @default(now())
  updatedAt       DateTime
  phase_templates phase_templates? @relation(fields: [phaseTemplateId], references: [id])
  proposals       proposals        @relation(fields: [proposalId], references: [id], onDelete: Cascade)

  @@index([proposalId])
}

model proposals {
  id                      String                    @id
  title                   String
  companyHQId             String
  contactId               String
  companyId               String
  estimatedStart          DateTime
  status                  String                    @default("draft")
  totalPrice              Float?
  purpose                 String?
  phases                  Json?
  milestones              Json?
  compensation            Json?
  dateIssued              DateTime?
  preparedBy              String?
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime
  consultant_deliverables consultant_deliverables[]
  proposal_deliverables   proposal_deliverables[]
  proposal_phases         proposal_phases[]
  company_hqs             company_hqs               @relation(fields: [companyHQId], references: [id], onDelete: Cascade)
  companies               companies                 @relation(fields: [companyId], references: [id], onDelete: Cascade)
  contacts                Contact                   @relation(fields: [contactId], references: [id], onDelete: Cascade)
}

model prospect_candidates {
  id          String   @id
  userId      String
  firstName   String?
  lastName    String?
  companyName String?
  domain      String?
  status      String   @default("pending")
  createdAt   DateTime @default(now())

  @@index([status])
  @@index([userId])
}

model saved_events {
  id               String   @id
  userId           String
  eventName        String
  eventSeriesName  String?
  organizerName    String
  producerType     String
  city             String
  stateOrRegion    String?
  startDate        String?
  endDate          String?
  costMin          Int?
  costMax          Int?
  currency         String
  personaAlignment Int
  url              String?
  rawJson          Json
  createdAt        DateTime @default(now())

  @@index([createdAt])
  @@index([userId])
}

model super_admins {
  id         String   @id
  ownerId    String   @unique
  platformId String
  createdAt  DateTime @default(now())
  updatedAt  DateTime
  owners     owners   @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  platform   platform @relation(fields: [platformId], references: [id], onDelete: Cascade)

  @@index([platformId])
}

model Template {
  id          String      @id @default(uuid())
  companyHQId String?     // company_hqs.id (optional - can be added later as follow-on feature)
  ownerId     String      // owners.id (required - who owns this template)
  title       String
  subject     String
  body        String
  createdAt   DateTime    @default(now())
  company_hqs company_hqs? @relation(fields: [companyHQId], references: [id], onDelete: Cascade)
  owners      owners       @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  campaigns   campaigns[]

  @@map("templates")
  @@index([companyHQId])
  @@index([ownerId])
}

model work_collateral {
  id                String               @id
  workPackageId     String?
  workPackageItemId String?
  presentationId    String?
  type              String
  title             String?
  contentJson       Json?
  status            WorkCollateralStatus @default(IN_PROGRESS)
  reviewRequestedAt DateTime?
  reviewCompletedAt DateTime?
  createdAt         DateTime             @default(now())
  updatedAt         DateTime

  @@index([presentationId])
  @@index([status])
  @@index([type])
  @@index([workPackageId])
  @@index([workPackageItemId])
}

model work_package_items {
  id                     String                @id
  workPackageId          String
  workPackagePhaseId     String
  deliverableType        String
  deliverableLabel       String
  deliverableDescription String?
  itemType               String                @default("")
  itemLabel              String                @default("")
  itemDescription        String?
  quantity               Int
  unitOfMeasure          String
  estimatedHoursEach     Int
  duration               Int?
  createdAt              DateTime              @default(now())
  status                 WorkPackageItemStatus @default(NOT_STARTED)
  work_packages          work_packages         @relation(fields: [workPackageId], references: [id], onDelete: Cascade)
  work_package_phases    work_package_phases   @relation(fields: [workPackagePhaseId], references: [id], onDelete: Cascade)

  @@unique([workPackageId, workPackagePhaseId, deliverableLabel])
  @@index([deliverableType])
  @@index([itemType])
  @@index([workPackageId])
  @@index([workPackagePhaseId])
}

model work_package_phases {
  id                  String               @id
  workPackageId       String
  name                String
  position            Int
  description         String?
  phaseTotalDuration  Int?
  totalEstimatedHours Int?
  createdAt           DateTime             @default(now())
  actualEndDate       DateTime?
  actualStartDate     DateTime?
  estimatedEndDate    DateTime?
  estimatedStartDate  DateTime?
  status              String?
  updatedAt           DateTime             @default(now())
  work_package_items  work_package_items[]
  work_packages       work_packages        @relation(fields: [workPackageId], references: [id], onDelete: Cascade)

  @@unique([workPackageId, name, position])
  @@index([position])
  @@index([workPackageId])
}

model work_packages {
  id                  String                @id
  companyId           String // ✅ Required - company-first (client company)
  workPackageOwnerId  String // ✅ Required - IgniteBD owner/creator (CompanyHQ.id - has editing permissions)
  workPackageClientId String // ✅ Required - client contact (renamed from workPackageOwnerId)
  workPackageMemberId String? // ✅ Optional - member contact (1-to-1 for now, can expand later)
  title               String
  description         String?
  prioritySummary     String?
  totalCost           Float?
  effectiveStartDate  DateTime?
  status              WorkPackageStatus     @default(ACTIVE)
  createdAt           DateTime              @default(now())
  updatedAt           DateTime
  metadata            Json? // Bolt-on capability for extensibility
  tags                String[]              @default([])
  invoices            invoices[]
  work_package_items  work_package_items[]
  work_package_phases work_package_phases[]
  companies           companies             @relation(fields: [companyId], references: [id], onDelete: Cascade)
  workPackageOwner    company_hqs           @relation("WorkPackageOwner", fields: [workPackageOwnerId], references: [id], onDelete: Restrict)
  workPackageClient   Contact               @relation("WorkPackageClient", fields: [workPackageClientId], references: [id], onDelete: Restrict)
  workPackageMember   Contact?              @relation("WorkPackageMember", fields: [workPackageMemberId], references: [id], onDelete: SetNull)

  @@index([companyId])
  @@index([workPackageOwnerId])
  @@index([workPackageClientId])
  @@index([workPackageMemberId])
  @@index([status])
}

enum EventOppStatus {
  CONSIDERING
  SHORTLIST
  GOING
  PASSED
}

model GoogleOAuthToken {
  id           String   @id @default(uuid())
  ownerId      String
  provider     String   @default("google")
  refreshToken String // TODO: Encrypt in production
  scopes       String? // Space-separated scopes
  email        String? // Google account email
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  owner owners @relation(fields: [ownerId], references: [id], onDelete: Cascade)

  @@unique([ownerId, provider])
  @@index([ownerId])
}

enum EventSourceType {
  AI
  CSV
  MANUAL
  WEB
}

enum EventType {
  ASSOCIATION
  COMMERCIAL
  MEDIA
  INDUSTRY
  PRIVATE
  CORPORATE
}

enum OrganizationArchetype {
  ASSOCIATION
  TRADE_GROUP
  GUILD
  NONPROFIT
  GOVERNMENT
  OTHER
}

enum WorkCollateralStatus {
  NOT_STARTED
  IN_PROGRESS
  IN_REVIEW
  CHANGES_NEEDED
  CHANGES_IN_PROGRESS
  APPROVED
}

enum WorkItemStatus {
  TODO
  IN_PROGRESS
  COMPLETED
}

enum WorkItemType {
  BLOG
  PERSONA
  OUTREACH_TEMPLATE
  EVENT_CLE_PLAN
  PRESENTATION_DECK
  LANDING_PAGE
}

enum WorkPackageItemStatus {
  NOT_STARTED
  IN_PROGRESS
  IN_REVIEW
  CHANGES_NEEDED
  CHANGES_IN_PROGRESS
  APPROVED
}

enum WorkPackageStatus {
  ACTIVE
  COMPLETED
}

enum BuyerPerson {
  BUSINESS_OWNER
  DIRECTOR_VP
  PRODUCT_USER
}

enum BuyingReadiness {
  NOT_READY
  READY_NO_MONEY
  READY_WITH_MONEY
}

enum RelationshipEnum {
  COLD
  WARM
  ESTABLISHED
  DORMANT
}

enum TypeOfPersonEnum {
  CURRENT_CLIENT
  FORMER_CLIENT
  FORMER_COWORKER
  PROSPECT
  PARTNER
  FRIEND_OF_FRIEND
}

model template_relationship_helpers {
  id               String      @id @default(uuid())
  ownerId          String
  relationshipType String // e.g. "FORMER_COWORKER", "FRIEND", "PROSPECT"
  familiarityLevel String // e.g. "COLD", "WARM", "ESTABLISHED"
  whyReachingOut   String
  desiredOutcome   String?
  timeHorizon      String?
  contextNotes     String?
  createdAt        DateTime    @default(now())
  company_hqs      company_hqs @relation(fields: [ownerId], references: [id], onDelete: Cascade)

  @@index([ownerId])
  @@index([createdAt])
}
